"use strict";!function e(n,t,o){function i(s,r){if(!t[s]){if(!n[s]){var c="function"==typeof require&&require;if(!r&&c)return c(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var d=t[s]={exports:{}};n[s][0].call(d.exports,function(e){var t=n[s][1][e];return i(t||e)},d,d.exports,e,n,t,o)}return t[s].exports}for(var a="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,n,t){function o(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{close:"",address:""},t=document.createElement("div");return t.setAttribute("class","bg-overlay add-new-address"),t.innerHTML='\n        <div class="close" data-action="close" title="'+n.close+'">&#9587;</div>\n        <div class="valign">\n            <div class="edit-marker-form">\n                <label for="address">'+n.address+'</label>\n                <input type="text" name="address" id="address" placeholder="'+n.address+'" class="add-marker-form__address"/>\n            </div>\n        </div>\n    ',e.append(t),t.querySelector('*[data-action="close"]').addEventListener("click",function(){return t.parentNode.removeChild(t)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.createAddnewContainer=o},{}],2:[function(e,n,t){function o(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=document.createElement("div");return o.setAttribute("class","bg-overlay edit-marker"),o.innerHTML='\n        <div class="close" data-action="close" title="'+n.close+'">&#9587;</div>\n        <div class="valign">\n            <div class="edit-marker-form">\n                <h1>'+n.editMarker+'</h1>\n                \n                <div class="field">\n                    <label for="address">'+n.address+'</label>\n                    <input type="text" id="address" name="address" placeholder="'+n.address+'" class="add-marker-form__address" value="'+t.address+'" />\n                </div>\n                \n                <div class="field">\n                    <input type="checkbox" id="display-window" name="displayWindow" '+(t.displayWindow?' checked="checked"':"")+' />\n                    <label for="display-window">'+n.displayInfo+'</label>\n                </div>\n                \n                <div class="field">\n                    <label for="content">'+n.content+'</label>\n                    <textarea name="content" id="content" rows="5" placeholder="'+n.content+'">'+t.content+'</textarea>\n                </div>\n                \n                <div class="field actions">\n                    <button name="delete" class="button delete">'+n.delete+'</button>\n                    <button name="save" class="button save">'+n.save+"</button>\n                </div>\n            </div>\n        </div>\n    ",e.append(o),o.querySelector('*[data-action="close"]').addEventListener("click",function(){return o.parentNode.removeChild(o)}),o}Object.defineProperty(t,"__esModule",{value:!0}),t.createEditorContainer=o},{}],3:[function(e,n,t){function o(e,n){var t=n.querySelector(".gmnoprint.gm-bundled-control.gm-bundled-control-on-bottom > .gmnoprint:first-child > div"),o=document.createElement("div");o.setAttribute("class","maps-editor__add-marker-container"),o.innerHTML='\n        <div class="maps-editor__add-marker-subcontainer">\n            <img src="'+e+'" draggable="false" class="maps-editor__add-new-marker" />\n        </div>\n    ';var i=document.createElement("div");return i.setAttribute("class","maps-editor__separator"),t.prepend(o),o.parentNode.insertBefore(i,o.nextSibling),o}Object.defineProperty(t,"__esModule",{value:!0}),t.createNavigationButton=o},{}],4:[function(e,n,t){function o(){return(0|9e6*Math.random()).toString(36)}Object.defineProperty(t,"__esModule",{value:!0}),t.createRandomId=o},{}],5:[function(e,n,t){function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),a=e("../functions/createNavigationButton"),s=e("../functions/createAddnewContainer"),r=e("../functions/createEditorContainer"),c=e("../functions/createRandomId"),d=e("./Marker"),l=function(e){return e&&e.__esModule?e:{default:e}}(d),u=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e),this._instance=null,this._container=n,this._markers=[],this._options={},this._navigationButton=null,this._defaults={map:{center:{lat:55.1309504,lng:24.5499231},zoom:7,scrollwheel:!1,navigationControl:!0,mapTypeControl:!1,scaleControl:!0,draggable:!0,streetViewControl:!1},sprite:"assets/images/sprite.png",closures:{onLoad:function(e){},onClickNavigationButton:function(e){e.onClickNavigationButton()},onMarkerClick:function(e,n){e.onMarkerClick(n)},onMarkerPlaced:function(e,n){},onMarkerSave:function(e,n){},onMarkerDelete:function(e,n){},onZoomChanged:function(e,n){},onCoordinatesChanged:function(e,n){}},translations:{close:"Close",address:"Type your address",editMarker:"Edit marker",displayInfo:"Display info window?",content:"Content",delete:"Delete",save:"Save"}},this.populateOptions(t),this.createInstance(),this.populateMarkers(),this.bindEvents()}return i(e,[{key:"getOptions",value:function(){return this._options}},{key:"bindEvents",value:function(){var e=this;google.maps.event.addListenerOnce(this._instance,"tilesloaded",function(){e._options.closures.onLoad(e);var n=e._options.sprite,t=e._container;e._navigationButton=(0,a.createNavigationButton)(n,t),e._navigationButton.addEventListener("click",function(){e._options.closures.onClickNavigationButton(e)})}),google.maps.event.addListener(this._instance,"zoom_changed",function(){e._options.closures.onZoomChanged(e,e._instance.getZoom())}),google.maps.event.addListener(this._instance,"dragend",function(){var n=e._instance.getCenter();e._options.closures.onCoordinatesChanged(e._instance,n.lat()+","+n.lng())}),google.maps.event.addListener(this._instance,"click",function(n){e.placeMarker(n.latLng)})}},{key:"onClickNavigationButton",value:function(){var e=this,n=(0,s.createAddnewContainer)(this._container,this._options.translations),t=n.querySelector('input[name="address"]');t.focus();var o=this.createSearchBox(t);o.addListener("places_changed",function(){var t=o.getPlaces();if(0!=t.length){var i=new google.maps.LatLngBounds;t.forEach(function(n){n.geometry&&(e.placeMarker(n.geometry.location,{address:n.formatted_address}),n.geometry.viewport?i.union(n.geometry.viewport):i.extend(n.geometry.location))}),e._instance.fitBounds(i),n.parentNode.removeChild(n)}})}},{key:"collectFieldsData",value:function(e){return{content:e.querySelector('textarea[name="content"]').value,displayWindow:e.querySelector('input[type="checkbox"]').checked}}},{key:"onMarkerClick",value:function(e){var n=this;if(e instanceof l.default){var t=(0,r.createEditorContainer)(this._container,this._options.translations,{address:e.options.address,content:e.options.content,displayWindow:e.options.displayWindow}),o=this.createSearchBox(t.querySelector('input[name="address"]'),t,!1,e),i=null;o.addListener("places_changed",function(){var n=o.getPlaces();i=new google.maps.LatLngBounds,n.forEach(function(n){n.geometry&&(e.temporary=Object.assign(e.temporary,{location:n.geometry.location,address:n.formatted_address}),n.geometry.viewport?i.union(n.geometry.viewport):i.extend(n.geometry.location))})}),t.querySelector('button[name="save"]').addEventListener("click",function(){var o=n.collectFieldsData(t);e.options=Object.assign(e.options,e.temporary,o),"location"in e.temporary&&(e.instance.setPosition(e.options.location),n._instance.fitBounds(i)),"content"in o&&e.instance.infoWindow.setContent(o.content),e.temporary={},n._options.closures.onMarkerSave(n,e),t.parentNode.removeChild(t)}),t.querySelector('button[name="delete"]').addEventListener("click",function(){n._options.closures.onMarkerDelete(n,e),n.removeMarker(e),t.parentNode.removeChild(t)})}}},{key:"createSearchBox",value:function(e){return new google.maps.places.SearchBox(e)}},{key:"populateOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"map"in e&&(e.map=Object.assign(this._defaults.map,e.map)),"closures"in e&&(e.closures=Object.assign(this._defaults.closures,e.closures)),this._options=Object.assign(this._defaults,e);var n=this.getJSONOrEmpty(this._container.getAttribute("data-options"));"map"in n&&(this._options.map=Object.assign(this._options.map,n.map),delete n.map),"closures"in n&&(this._options.closures=Object.assign(this._options.closures,n.closures),delete n.closures),this._options=Object.assign(this._options,n)}},{key:"populateMarkers",value:function(){var e=this,n=this.getJSONOrEmpty(this._container.getAttribute("data-markers"));n&&n.forEach(function(n){var t=n.coordinates.split(",").map(Number).filter(function(e){return!isNaN(e)});e.placeMarker(new google.maps.LatLng(t[0],t[1]),{address:n.address||"",content:n.content||"",displayWindow:n.displayWindow,instanceId:n.instanceId},!1)})}},{key:"createInstance",value:function(){this._instance=new google.maps.Map(this._container,this._options.map)}},{key:"placeMarker",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i={default:new google.maps.MarkerImage(this._options.sprite,new google.maps.Size(26,32),new google.maps.Point(0,32)),active:new google.maps.MarkerImage(this._options.sprite,new google.maps.Size(26,32),new google.maps.Point(32,32))},a=new l.default(Object.assign({instanceId:(0,c.createRandomId)(),markerImage:i.default,location:e,draggable:!0,infoWindowOn:"hover",events:{onMouseover:function(e){e.instance.setIcon(i.active)},onMouseout:function(e){e.instance.setIcon(i.default)}}},t),this._instance);google.maps.event.addListener(a.instance,"click",function(){n._options.closures.onMarkerClick(n,a)}),google.maps.event.addListener(a.instance,"dragend",function(){n._options.closures.onMarkerSave(n,a)}),o&&this._options.closures.onMarkerPlaced(this,a),this._markers.push(a)}},{key:"removeMarker",value:function(e){e.instance.setMap(null);var n=!1;this._markers.forEach(function(t,o){e.instanceId==t.instanceId&&(n=o)}),isNaN(n)||delete this._markers[n]}},{key:"getMarkers",value:function(){return this._markers}},{key:"getJSONOrEmpty",value:function(e){return void 0===e||""==e?{}:JSON.parse(e)}}]),e}();t.default=u},{"../functions/createAddnewContainer":1,"../functions/createEditorContainer":2,"../functions/createNavigationButton":3,"../functions/createRandomId":4,"./Marker":6}],6:[function(e,n,t){function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),a=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];o(this,e),this.map=t,this.defaults={instanceId:null,location:null,address:"",coordinates:"",displayWindow:!1,content:"",icon:"",markerImage:null,draggable:!1,infoWindowOn:"click",events:{onClick:function(e){},onMouseover:function(e){},onMouseout:function(e){}}},this.temporary={},"events"in n&&(n.events=Object.assign(this.defaults.events,n.events)),this.options=Object.assign(this.defaults,n),this.createInstance(),this.bindEvents()}return i(e,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.options=Object.assign(this.options,e),"location"in e&&this.instance.setPosition(e.location),"coordinates"in e){var n=e.coordinates.split(",").map(Number).filter(function(e){return!isNaN(e)});this.options.location=new google.maps.LatLng(n[0],n[1]),this.instance.setPosition(this.options.location)}}},{key:"getCoordinates",value:function(){return this.instance.getPosition().lat()+", "+this.instance.getPosition().lng()}},{key:"getData",value:function(){return{InstanceId:this.options.instanceId,Address:this.options.address,Coordinates:this.getCoordinates(),Content:this.options.content,DisplayWindow:this.options.displayWindow}}},{key:"createInstance",value:function(){if(null==this.options.location&&""!=this.options.coordinates){var e=this.options.coordinates.split(",").map(Number).filter(function(e){return!isNaN(e)});this.options.location=new google.maps.LatLng(e[0],e[1])}this.instance=new google.maps.Marker({map:this.map,icon:this.options.markerImage||this.options.icon,position:this.options.location,draggable:this.options.draggable}),this.instance.infoWindow=new google.maps.InfoWindow({content:this.options.content})}},{key:"bindEvents",value:function(){var e=this;switch(this.options.infoWindowOn){case"click":google.maps.event.addListener(this.instance,"click",function(){e.options.events.onClick(e),e.open()});break;case"hover":google.maps.event.addListener(this.instance,"mouseover",function(){e.options.events.onMouseover(e),e.open()}),google.maps.event.addListener(this.instance,"mouseout",function(){e.options.events.onMouseout(e),e.close()});break;default:return}}},{key:"getInstanceId",value:function(){return this.options.instanceId}},{key:"open",value:function(){this.options.displayWindow&&this.instance.infoWindow.open(this.map,this.instance)}},{key:"close",value:function(){this.instance.infoWindow.close()}}]),e}();t.default=a},{}],7:[function(e,n,t){var o=e("./blocks/maps/modules/GoogleMapEditor"),i=function(e){return e&&e.__esModule?e:{default:e}}(o);!function(e){e.entwine("ss",function(e){e('*[data-module="editor"]').entwine({onmatch:function(){var n=this;if(window.editor={readyApi:!1,instance:null,api:e(this).data("key"),init:function(){window.editor.instance=new i.default(e(n)[0],{closures:{onMarkerPlaced:function(t,o){e.ajax({url:e(n).data("update-marker-link"),method:"GET",data:o.getData()})},onMarkerSave:function(t,o){e.ajax({url:e(n).data("update-marker-link"),method:"GET",data:o.getData()})},onMarkerDelete:function(t,o){e.ajax({url:e(n).data("delete-marker-link"),method:"GET",data:{InstanceId:o.options.instanceId}})},onZoomChanged:function(t,o){e.ajax({url:e(n).data("zoom-changed-link"),method:"GET",data:{zoom:o}})},onCoordinatesChanged:function(t,o){e.ajax({url:e(n).data("coordinates-changed-link"),method:"GET",data:{coordinates:o}})}}})}},!window.editor.readyApi)if(e("#google-maps-api").length<=0){var t=document.createElement("script");t.id="google-maps-api",t.type="text/javascript",t.src="//maps.googleapis.com/maps/api/js?key="+window.editor.api+"&libraries=places&callback=window.editor.init",document.body.appendChild(t),window.editor.readyApi=!0}else window.editor.readyApi=!0,window.editor.init()}})})}(jQuery)},{"./blocks/maps/modules/GoogleMapEditor":5}]},{},[7]);
//# sourceMappingURL=maps-backend.js.map
